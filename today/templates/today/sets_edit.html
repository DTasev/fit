{% extends 'base_generic.html' %}
{% load enumerate %}

{% block script_head %}
  <script>
      /**
       *
       * @param inputId
       * @param element
       */
      function addNumberToInput(element, inputId) {
          const input_field = document.getElementById(inputId);
          const new_val = eval(input_field.value + element.textContent);
          input_field.value = new_val < 0 ? 0 : new_val;
      }
  </script>
{% endblock %}
{% block content %}
  <div class="card my-3">
    <h2 class="text-center py-4 lead">{{ exercise }}
      <a target="_blank" href="https://www.google.co.uk/search?q={{ exercise }}"><i class="fab fa-google"></i></a>
    </h2>

    <table class="table table-sm text-center">
      <thead>
      <tr>
        <th>Set</th>
        <th>KGs</th>
        <th>Reps</th>
        <th>Options</th>
      </tr>
      </thead>
      <tbody>
      {% for i, set in exercise.sets.order_by|enumerate %}
        <tr>
          <td>{{ i }}</td>
          <td>{{ set.kgs }}</td>
          <td>{{ set.reps }}</td>
          <td><a class="btn btn-outline-dark btn-sm" href="{% url 'today:sets:edit_set' set.pk %}">Edit</a></td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    <div class="">
      <form method="post" action="{% url 'today:sets:repeat_set' exercise.id %}" class="pb-3">
        {% csrf_token %}

        <input type="submit" value="Repeat Last" class="btn btn-outline-dark btn-block"/>
      </form>
    </div>
    <form method="post" action="{% url 'today:sets:add_set' exercise.id %}">
      {% csrf_token %}
      <div class="input-group mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="basic-addon1">KGs</span>
        </div>
        <input type="number" step="0.5" class="form-control" placeholder="e.g. 30" name="kgs" id="kgs-input-field"
               min="0"
               value="{{ prev_kgs_value }}">
      </div>
      {% include 'today/sets_buttons_partial.html' with input_field_id="kgs-input-field" %}
      {% if kgs_error %}
        <div class="btn-danger text-white p-2 m-2">{{ kgs_error }}</div>
      {% endif %}
      <div class="input-group mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="basic-addon1">Reps</span>
        </div>
        <input type="number" class="form-control" placeholder="e.g. 12" name="reps" min="0" id="reps-input-field"
               value="{{ prev_reps_value }}">
      </div>
      {% include 'today/sets_buttons_partial.html' with input_field_id="reps-input-field" %}

      {% if reps_error %}
        <div class="btn-danger text-white p-2 m-2">{{ reps_error }}</div>
      {% endif %}

      <input type="submit" value="Add" class="btn btn-outline-dark btn-block"
             style="width: 100%"/>
      <input type="hidden" name="next" value="{{ next }}"/>
    </form>
    <form method="post" action="{% url 'today:sets:del_set' exercise.id %}" class="pt-3">
      {% csrf_token %}

      <input type="submit" value="Remove Last" class="btn btn-outline-dark btn-block"
             style="width: 100%"/>
    </form>
  </div>
{% endblock %}