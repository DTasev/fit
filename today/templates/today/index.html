{% extends 'base_generic.html' %}
{% load tz %}
{% block fab %}
  {% if not object_list.completed %}
    <li class="fab-menu-item-1">
      <a href="{% url 'today:create' %}" class="fab-menu-button fab-menu-item-icon">G</a>
      <div class="fab-menu-item-label">Generate Workout</div>
    </li>

    {% if object_list %}
      {% if not object_list.start_time %}
        <li class="fab-menu-item-2">
          <form action="{% url 'today:start' object_list.pk %}" method="post">
            {% csrf_token %}
            <input type="submit" class="fab-menu-button fab-menu-item-icon" value="S">
            <div class="fab-menu-item-label">Start Workout</div>
          </form>
        </li>
      {% endif %}
    {% endif %}
  {% endif %}
{% endblock %}
{% block content %}
  <div class="mt-3 mx-2">
    {% if not object_list.completed %}
      <a href="{% url 'today:create' %}" class="btn btn-outline-dark btn-block bg-white mb-3">Generate New Workout</a>

      {% if object_list %}
        {% if not object_list.start_time %}
          <form action="{% url 'today:start' object_list.pk %}" method="post">
            {% csrf_token %}
            <button class="btn btn-outline-dark btn-block bg-white">Start Workout</button>
          </form>
        {% else %}
          <div>Duration:
            <div id="duration" class="d-inline-block">{{ object_list.duration }}</div>
          </div>
          <script>
              (function () {
                  const duration = document.getElementById("duration");
                  if (duration.textContent.length === 7) {
                      duration.textContent = "0" + duration.textContent;
                  }
                  const date = new Date("2000-01-01T" + duration.textContent + "Z");
                  setInterval(() => {
                      date.setSeconds(date.getSeconds() + 1);
                      duration.innerHTML = date.toLocaleTimeString();
                  }, 1000)
              })()
          </script>
        {% endif %}
      {% endif %}
    {% endif %}

    {% if object_list %}
      <div class="card-body my-3
{% if object_list.completed %}
border border-success
{% elif object_list.start_time %}
border border-warning
{% endif %}
">
        <p class="lead">Today's Workout:</p>
        {% if sets_error_message %}
          <div class="bg-danger p-3" id="sets-error-message">{{ sets_error_message }}</div>
          <script>
              setTimeout(() => {
                  document.getElementById("sets-error-message").style.display = "none";
              }, 3000);
          </script>
        {% endif %}
        <hr>
        <div class="card mx-auto" style="width: 18rem;">
          <div class="card-header">
            <h5>Primary</h5>
          </div>
          <ul class="list-group list-group-flush">
            {% include 'today/index_exercise_snippet.html' with workout_exercises=object_list.primary completed=object_list.completed %}
          </ul>
        </div>

        {% if object_list.secondary %}
          <div class="card mx-auto " style="width: 18rem; margin-top: 0.3rem">
            <div class="card-header">
              <h5>Secondary</h5>
            </div>
            <ul class="list-group list-group-flush">
              {% include 'today/index_exercise_snippet.html' with workout_exercises=object_list.secondary completed=object_list.completed %}
            </ul>
          </div>
        {% endif %}
      </div>
      <form action="{% url 'today:complete' object_list.id %}" method="post">
        {% csrf_token %}
        {% if object_list.completed %}
          <button class="btn btn-dark btn-block">Remove Completion</button>
        {% else %}
          <button class="btn btn-dark btn-block">Complete Workout</button>
        {% endif %}
      </form>
    {% else %}
      <div class="mx-auto text-center mt-3">
        <h3>You don't seem to have a workout for today. Create one!</h3>
      </div>
    {% endif %}
  </div>
{% endblock %}